# -*- coding: utf-8 -*-
"""prediction-modelling.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1-r_Ese3hrz0EK6K_BbBQd3WAD5qTWgdK

## Case Study: Analysis of Health-Related Factors and Their Impact on Medical Insurance Costs
"""

# import modules and libraries
import pandas as pd
from sklearn.model_selection import train_test_split
from sklearn.linear_model import LinearRegression, Ridge, Lasso
from sklearn.ensemble import RandomForestRegressor, GradientBoostingRegressor
from sklearn.metrics import root_mean_squared_error
from sklearn.metrics import r2_score

"""#### Data Preprocessing - One Hot Encoding Categorical Variables"""

# Load data
df = pd.read_csv('/content/drive/MyDrive/Colab Notebooks/data-files/insurance_costs_dataset.csv', sep =',')

# Applying one-hot encoding
df_encoded = pd.get_dummies(df, dtype=int)
df_encoded

"""#### Splitting the data for training and testing"""

# Factors (X) and target variable - charges (y)
X = df_encoded.drop(columns=['charges'])
y = df_encoded['charges']

# Split the data into training and testing sets (train set =80%)
X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=42)

"""#### Model Training and Comparison"""

# Initialize models
models = {
    'Linear Regression': LinearRegression(),
    'Ridge Regression': Ridge(),
    'Lasso Regression': Lasso(),
    'Random Forest': RandomForestRegressor(),
    'Gradient Boosting': GradientBoostingRegressor()
}

# Train models and store predictions
predictions_train ={}
predictions_test = {}
for model_name, model in models.items():
    model.fit(X_train, y_train)
    predictions_train[model_name] = model.predict(X_train)
    predictions_test[model_name] = model.predict(X_test)

# Evaluate models using Root Mean Squared Error (RMSE)
rmse_train = {}

for model_name, preds in predictions_train.items():
    rmse = root_mean_squared_error(y_train, preds)
    rmse_train[model_name] = rmse
    print(f'{model_name} - Root Mean Squared Error (Training): {rmse}')

rmse_test = {}

for model_name, preds in predictions_test.items():
    rmse = root_mean_squared_error(y_test, preds)
    rmse_test[model_name] = rmse
    print(f'{model_name} - Root Mean Squared Error (Testing): {rmse}')

# Evaluate models using R^2
r2_train = {}
for model_name, preds in predictions_train.items():
    r2 = r2_score(y_train, preds)
    r2_train[model_name] = r2
    print(f'{model_name} - R Squared (Training): {r2}')

# Evaluate models using R^2
r2_test = {}
for model_name, preds in predictions_test.items():
    r2 = r2_score(y_test, preds)
    r2_test[model_name] = r2
    print(f'{model_name} - R Squared (Testing): {r2}')